generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int      @id @default(autoincrement())
  telegramId String   @unique
  name       String
  avatar     String?
  plan       String   @default("free")
  createdAt  DateTime @default(now())

  spaces       SpaceMember[]
  transactions Transaction[]
}

model Space {
  id          Int      @id @default(autoincrement())
  name        String
  inviteToken String   @unique @default(cuid())
  createdAt   DateTime @default(now())

  members      SpaceMember[]
  transactions Transaction[]
  categories   Category[]
}

// role: "owner" | "member_full" | "member_own"
model SpaceMember {
  id      Int    @id @default(autoincrement())
  role    String @default("member_full")
  user    User   @relation(fields: [userId], references: [id])
  userId  Int
  space   Space  @relation(fields: [spaceId], references: [id])
  spaceId Int

  @@unique([userId, spaceId])
}

model Transaction {
  id               Int      @id @default(autoincrement())
  type             String   // INCOME | EXPENSE
  amount           Float
  date             String   // YYYY-MM-DD
  category         String
  status           String   @default("ACTUAL")   // ACTUAL | PLANNED
  recurrence       String   @default("NONE")      // NONE | DAILY | WEEKLY | MONTHLY | YEARLY
  recurrenceEndDate String?
  includeInBalance Boolean  @default(true)
  description      String?
  createdAt        DateTime @default(now())

  addedBy   User  @relation(fields: [addedById], references: [id])
  addedById Int
  space     Space @relation(fields: [spaceId], references: [id])
  spaceId   Int
}

model Category {
  id      Int    @id @default(autoincrement())
  name    String
  type    String @default("EXPENSE")  // INCOME | EXPENSE
  color   String @default("#3B82F6")
  icon    String?
  space   Space  @relation(fields: [spaceId], references: [id])
  spaceId Int
}
